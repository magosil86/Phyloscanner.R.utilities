<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inferring the direction of transmission • Phyloscanner.R.utilities</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Inferring the direction of transmission">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Phyloscanner.R.utilities</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Rakai.01.data_description.html">Data description</a>
    </li>
    <li>
      <a href="../articles/Rakai.02.run_phyloscanner.html">Running *phyloscanner* in high-throughput on a population-based sample</a>
    </li>
    <li>
      <a href="../articles/Rakai.03.reconstruct_transmission_networks.html">Reconstructing transmission networks</a>
    </li>
    <li>
      <a href="../articles/Rakai.04.direction_of_transmission.html">Inferring the direction of transmission</a>
    </li>
    <li>
      <a href="../articles/Stage1.create.read.alignments.html">Stage 1 analysis: identify phylogenetically closely related individuals</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/olli0601/Phyloscanner.R.utilities">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Inferring the direction of transmission</h1>
                        <h4 class="author">Oliver Ratmann</h4>
            
            <h4 class="date">2018-10-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/olli0601/Phyloscanner.R.utilities/blob/master/vignettes/Rakai.04.direction_of_transmission.Rmd"><code>vignettes/Rakai.04.direction_of_transmission.Rmd</code></a></small>
      <div class="hidden name"><code>Rakai.04.direction_of_transmission.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p><a href="Rakai.03.reconstruct_transmission_networks.html">In the previous tutorial</a>, we inferred transmission networks from large scale <em>phyloscanner</em> output.</p>
<p><strong>In this tutorial, we will identify phylogenetically highly-supported source-recipient pairs within reconstructed transmission networks.</strong> We will:</p>
<ol style="list-style-type: decimal">
<li>Classify phylogenetic linkages based on their phylogenetic support.</li>
<li>Test phylogenetic inferences into the direction of transmission against available epidemiologic data.</li>
</ol>
</div>
<div id="setting-up-the-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-up-the-analysis" class="anchor"></a>Setting up the analysis</h2>
<p>We resume analysis from <a href="Rakai.03.reconstruct_transmission_networks.html">the previous tutorial</a>, and start by loading the pairs of individuals between whom linkage could not be excluded, and the transmission networks that could be inferred amongst them:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">HOME &lt;-<span class="st"> "/Users/Oliver/sandbox/DeepSeqProjects"</span>
indir &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(HOME, <span class="st">"RakaiPopSample_phyloscanner_analysis"</span>)
infile.pairs &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(indir, <span class="st">"phsc_analysis_of_dataset_S1_allpairs.rda"</span>)
infile.networks &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(indir, <span class="st">"phsc_analysis_of_dataset_S1_allnetworks.rda"</span>)
<span class="kw"><a href="https://rdrr.io/r/base/load.html">load</a></span>(infile.pairs)  <span class="co"># loads rtp, rplkl, rpw</span>
<span class="kw"><a href="https://rdrr.io/r/base/load.html">load</a></span>(infile.networks)  <span class="co"># loads rtn, rtnn</span></code></pre></div>
<p>Do make sure that the directory names above do not start with “~”, because the names are not expanded in the scripts below. White space, or characters like ‘-’ are OK.</p>
</div>
<div id="classify-phylogenetic-linkages" class="section level2">
<h2 class="hasAnchor">
<a href="#classify-phylogenetic-linkages" class="anchor"></a>Classify phylogenetic linkages</h2>
<p>The data.table <code>rtnn</code> contains all information needed to classify linkages. Following analysis of the Rakai population-based sample, we specify as cut-off for strong support of phylogenetic linkage that the proportion of deep-sequence phylogenies with close and adjacent subgraphs of two indivuals in the most likely transmission chain exceeds 60% (<code>conf.cut</code>= 60%):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">conf.cut &lt;-<span class="st"> </span><span class="fl">0.6</span>
rtnn[, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span>(PHYLOSCANNER_CLASSIFY, <span class="ot">NA_character_</span>)]
<span class="kw">set</span>(rtnn, rtnn[, <span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(PTY_RUN))], <span class="st">"PHYLOSCANNER_CLASSIFY"</span>, <span class="st">"insufficient deep sequence data for at least one individual"</span>)
<span class="kw">set</span>(rtnn, rtnn[, <span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(!<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(PTY_RUN) &amp;<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(LINK_12) &amp;<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(LINK_21))], 
    <span class="st">"PHYLOSCANNER_CLASSIFY"</span>, <span class="st">"ph unlinked pair"</span>)
<span class="kw">set</span>(rtnn, rtnn[, <span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(!<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(POSTERIOR_SCORE_LINKED) &amp;<span class="st"> </span>POSTERIOR_SCORE_LINKED &lt;=<span class="st"> </span>
<span class="st">    </span>conf.cut)], <span class="st">"PHYLOSCANNER_CLASSIFY"</span>, <span class="st">"unclear if pair ph linked or unlinked"</span>)
<span class="kw">set</span>(rtnn, rtnn[, <span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(!<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(POSTERIOR_SCORE_LINKED) &amp;<span class="st"> </span>POSTERIOR_SCORE_LINKED &gt;<span class="st"> </span>
<span class="st">    </span>conf.cut)], <span class="st">"PHYLOSCANNER_CLASSIFY"</span>, <span class="st">"ph linked pair direction not resolved"</span>)
<span class="kw">set</span>(rtnn, rtnn[, <span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(!<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(POSTERIOR_SCORE_LINKED) &amp;<span class="st"> </span>POSTERIOR_SCORE_LINKED &gt;<span class="st"> </span>
<span class="st">    </span>conf.cut &amp;<span class="st"> </span>POSTERIOR_SCORE_12 &gt;<span class="st"> </span>conf.cut)], <span class="st">"PHYLOSCANNER_CLASSIFY"</span>, <span class="st">"ph linked pair direction 12"</span>)
<span class="kw">set</span>(rtnn, rtnn[, <span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(!<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(POSTERIOR_SCORE_LINKED) &amp;<span class="st"> </span>POSTERIOR_SCORE_LINKED &gt;<span class="st"> </span>
<span class="st">    </span>conf.cut &amp;<span class="st"> </span>POSTERIOR_SCORE_21 &gt;<span class="st"> </span>conf.cut)], <span class="st">"PHYLOSCANNER_CLASSIFY"</span>, <span class="st">"ph linked pair direction 21"</span>)</code></pre></div>
<p>We already noted <a href="Rakai.03.reconstruct_transmission_networks.html">in the previous tutorial</a> that highly-supported phylogenetic linkage does not exclude the possibility that unsampled intermediates may be present, even with deep sequence data. To better interpret inferred, phylogenetically highly supported linkages, we add information by gender:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tmp &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(rtp, <span class="dt">select =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(ID1, ID2, ID1_SEX, ID2_SEX))
rtnn &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/merge.html">merge</a></span>(rtnn, tmp, <span class="dt">by =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ID1"</span>, <span class="st">"ID2"</span>))
tmp &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(rtnn, ID1_SEX ==<span class="st"> "F"</span> &amp;<span class="st"> </span>ID2_SEX ==<span class="st"> "M"</span>)
<span class="kw">setnames</span>(tmp, <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(tmp), <span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"xx"</span>, <span class="st">"ID2"</span>, <span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"ID2"</span>, <span class="st">"ID1"</span>, <span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"ID1"</span>, 
    <span class="st">"xx"</span>, <span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"xx"</span>, <span class="st">"12"</span>, <span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"12"</span>, <span class="st">"21"</span>, <span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"21"</span>, <span class="st">"xx"</span>, <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(tmp))))))))
<span class="kw">set</span>(tmp, <span class="ot">NULL</span>, <span class="st">"PHYLOSCANNER_CLASSIFY"</span>, tmp[, <span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"xx"</span>, <span class="st">"12"</span>, <span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"12"</span>, <span class="st">"21"</span>, 
    <span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"21"</span>, <span class="st">"xx"</span>, PHYLOSCANNER_CLASSIFY)))])
rtnn &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(rtnn, !(ID1_SEX ==<span class="st"> "F"</span> &amp;<span class="st"> </span>ID2_SEX ==<span class="st"> "M"</span>)), tmp)
rtnn[, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span>(PAIR_SEX, <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(ID1_SEX, ID2_SEX))]
rtp &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(rtnn, !<span class="kw"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"unlinked|insufficient"</span>, PHYLOSCANNER_CLASSIFY))
rtp[, <span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>(PAIR_SEX)]</code></pre></div>
<p>Thus, a considerable proportion of highly supported phylogenetic links were between two women, even though HIV-1 is extremely rarely transmitted sexually between women, suggesting that unsampled intermediates are likely present. From these numbers, we expect that the proportion of highly supported male-female links between whom there are likely unsampled intermediates could be up to 35.4%, because there are almost twice as many possible male-female combinations than female-female combinations.</p>
</div>
<div id="validate-phylogenetic-inferences-into-the-direction-of-transmission" class="section level2">
<h2 class="hasAnchor">
<a href="#validate-phylogenetic-inferences-into-the-direction-of-transmission" class="anchor"></a>Validate phylogenetic inferences into the direction of transmission</h2>
<p>These observations prompted us to focus on using deep-sequence data for inferences into the direction of transmission at the population-level, and within partially sampled networks. Our main idea is that source cases, that were phylogenetically identified, likely are transmitters regardless of the presence of unsampled intermediates. Therefore, as a whole they provide evidence into the sources of epidemic spread. To validate our inferences, we considered phylogenetically linked pairs of individuals with epidemiological and clinical data on the direction of transmission. We start by loading these data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">infile &lt;-<span class="st"> "~/sandbox/DeepSeqProjects/RakaiPopSample_data/Dataset_S3.csv"</span>
red &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(<span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(infile))
<span class="kw">setnames</span>(red, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"MALE_ID"</span>, <span class="st">"FEMALE_ID"</span>), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ID1"</span>, <span class="st">"ID2"</span>))</code></pre></div>
<p>Let us compare the epidemiologic data against our phylogenetic inferences:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># select male-female pairs with highly supported direction</span>
rtpd &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(rtnn, ID1_SEX ==<span class="st"> "M"</span> &amp;<span class="st"> </span>ID2_SEX ==<span class="st"> "F"</span> &amp;<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"direction 12|direction 21"</span>, 
    PHYLOSCANNER_CLASSIFY))
<span class="kw">set</span>(rtpd, <span class="ot">NULL</span>, <span class="st">"PHYLOSCANNER_CLASSIFY"</span>, rtpd[, <span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"ph linked pair direction 21"</span>, 
    <span class="st">"fm"</span>, <span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"ph linked pair direction 12"</span>, <span class="st">"mf"</span>, PHYLOSCANNER_CLASSIFY))])
<span class="kw">setnames</span>(rtpd, <span class="st">"PHYLOSCANNER_CLASSIFY"</span>, <span class="st">"PHYSCANNER_DIR"</span>)
rtpd &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(rtpd, <span class="dt">select =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(ID1, ID2, PHYSCANNER_DIR))
rtpd &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/merge.html">merge</a></span>(rtpd, red, <span class="dt">by =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ID1"</span>, <span class="st">"ID2"</span>))
rtpd[, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span>(PHYSCANNER_DIR_CONSISTENT, <span class="kw"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(PHYSCANNER_DIR ==<span class="st"> </span>EPID_EVIDENCE_DIR))]
rtpd[, <span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>(PHYSCANNER_DIR_CONSISTENT)]</code></pre></div>
<p>Thus, the large majority of phylogenetic inferences in our validation panel are consistent with epidemiologic and clinical data.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#setting-up-the-analysis">Setting up the analysis</a></li>
      <li><a href="#classify-phylogenetic-linkages">Classify phylogenetic linkages</a></li>
      <li><a href="#validate-phylogenetic-inferences-into-the-direction-of-transmission">Validate phylogenetic inferences into the direction of transmission</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Oliver Ratmann.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
